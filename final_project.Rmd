---
title: "Final Project"
output: html_document
date: "2023-12-01"
---

# Introduction

##    Context

##    Prior Information

##    Questions

##    Why (are we doing this report)

# Data

##    Why These Datasets

##    Where The Data Came From (in data documentation)

##    Who Collected The Data  (in data documentation)

##    Data Usage Permissions

##    What Are Datasets About

##    Data Quality Issues

##    Data Description (already done below in data documentation)

# Methods

##    What Did We Do (explain all data processing choices)

##    Which Variables Did We Include, Why?

##    How Did We Process Data

##    How Did We select Our Sample

##    Technical Decisions Made (ex. removing/replacing missing values)

##    Did We Use More Complex Statistical Methods (no)

# Results

##    What The Data Tells Us

# Findings

##    What Do the Results Tell Us About Our Question/Story

##    Limitations

##    Future Work

# Summary
# Loading The Data
```{r}
library(tidyverse)

demographic_data <- read_delim("acs2017_county_data.csv")
us_census <- read_delim("president_county.csv")
```

# Cleaning and Merging Data
```{r}
demographic_data <- demographic_data %>% 
  select(State, County, Men,TotalPop, Women, Hispanic, White, Black, Native, Asian, Pacific, "VotingPop" = VotingAgeCitizen)


us_census <- us_census %>% 
  select("State" = state, "County" = county, "TotalVotes" = total_votes)

census_demographic_merge <- left_join(us_census,demographic_data, by= c("State","County"))
```

# Data Documentation

We found both our datasets from the website Kaggle, an online data sharing website.

The first dataset we used was the acs2017_county_data.csv file. We found this dataset at the
following link: https://www.kaggle.com/datasets/muonneutrino/us-census-demographic-data. The
data was collected by mounneutrino and taken from the 2015 American Community Survey 5-year
estimates.

The second dataset we used was the president_county.csv file. We found this dataset at the
following link: 
https://www.kaggle.com/datasets/unanimad/us-election-2020?select=president_county.csv. The
data was collected by Raphael Fontes and taken from 2020 US Election data.

We cleaned and merged these two datasets to create the dataset: census_demographic_merge.
```{r}
head(census_demographic_merge,3)
```
 This dataset has `r nrow(census_demographic_merge)` rows,`r ncol(census_demographic_merge)`,
 columns, and the following number of missing values for each column:
```{r}
 colNA <- colSums(is.na(census_demographic_merge))
colNA
```

The variables we will be using for this report are: `r names(census_demographic_merge)`.

* State: represents the name of the state where the data was collected.
* County: represents the name of the county where the data was collected.
* Total_votes: represents the total amount of votes made in a county.
* Men: represents the total number of men in the county.
* TotalPop: represents the total number of people in the county.
* Women: represents the total number of women in the county.
* Hispanic: represents the total percentage of Hispanic/Latino people in the county.
* White: represents the total percentage of white people in the county.
* Black: represents the total percentage of black people in the county.
* Native: represents the total percentage of Native Americans in the county.
* Asian: represents the total percentage of Asians in the county.
* Pacific: represents the total percentage of Pacific Islanders in the county.
* VotingPop: represents the total number of people eligble to vote in the county.

Question 1:


#1 Question 1. Which State has the highest demographic of each voting population?

```{r}
census_demographic_merge <- census_demographic_merge %>%
  group_by(State) %>%
  mutate(total_votes_by_state = sum(TotalVotes))

head(census_demographic_merge,5)

```

```{r}

census_demographic_new <- census_demographic_merge %>%
  pivot_longer(cols = c(Hispanic, White, Black, Native, Pacific, Asian),
               names_to = "Ethnicity",
               values_to = "Votes") %>%
  group_by(Ethnicity) %>%
  summarize(TotalVotes = sum(Votes, na.rm = TRUE))

# Plotting
ggplot(census_demographic_new, aes(x = Ethnicity, y = TotalVotes, fill = Ethnicity)) +
  geom_bar(stat = "identity") +
  labs(
    x = "Ethnicity",
    y = "Total Number of Votes",
    title = "Total Number of Votes by Ethnicity Across States"
  ) +
  theme_minimal()

```

# Question 2: Find the Top three counties in the country that have the highest ratio of non-voters to eligible voting population.
```{r}
#make a new colums that calculates the number of non voters

# Assuming your data frame is named 'census_demographic_merge'
census_demographic_merge <- census_demographic_merge %>%
  mutate(non_voters = VotingPop - TotalVotes)

# Print or view the updated data frame
print(census_demographic_merge)

```

```{r}
top3_non_voters_counties <- census_demographic_merge %>%
  group_by(County) %>%
  summarize(total_non_voters = sum(non_voters, na.rm = TRUE),
            total_VotingPop = sum(VotingPop, na.rm = TRUE)) %>%
  arrange(desc(total_non_voters)) %>%
  slice_head(n = 3)

# Plotting
ggplot(top3_non_voters_counties, aes(x = reorder(County, -total_non_voters), 
                                     fill = factor(c("VotingPop", "non_voters")))) +
  geom_bar(aes(y = total_VotingPop), stat = "identity", position = "stack", fill = "pink") +
  geom_bar(aes(y = total_non_voters), stat = "identity", position = "stack", fill = "purple") +
  labs(
    x = "County",
    y = "Count",
    title = "Top 3 Counties with the Highest Number of Non-Voters and VotingPop"
  ) +
  scale_fill_manual(values = c("VotingPop" = "pink", "non_voters" = "purple")) +
  theme_minimal()
```

# Plotting the ethnicity breakdown of the top 3 non-voting counties
```{r}
#for Los Angeles County

# Filter data for Los Angeles County
la_county_data <- census_demographic_merge %>%
  filter(County == "Los Angeles County")

# Pivot the data into long format for easier plotting
la_county_data_long <- la_county_data %>%
  pivot_longer(cols = c(Hispanic, White, Black, Native, Pacific, Asian),
               names_to = "Ethnicity",
               values_to = "Votes")

# Plotting
ggplot(la_county_data_long, aes(x = Ethnicity, y = Votes, fill = Ethnicity)) +
  geom_bar(stat = "identity") +
  labs(
    x = "Ethnicity",
    y = "Number of Votes",
    title = "Ethnicity Breakdown in Los Angeles County"
  ) +
  theme_minimal()

#For Cook County
cook_county_data <- census_demographic_merge %>%
  filter(County == "Cook County")
cook_county_data_long <- cook_county_data %>%
  pivot_longer(cols = c(Hispanic, White, Black, Native, Pacific, Asian),
               names_to = "Ethnicity",
               values_to = "Votes")
ggplot(cook_county_data_long, aes(x = Ethnicity, y = Votes, fill = Ethnicity)) +
  geom_bar(stat = "identity") +
  labs(
    x = "Ethnicity",
    y = "Number of Votes",
    title = "Ethnicity Breakdown in Cook County"
  ) +
  theme_minimal()

#For Harris County

# Filter data for Harris County
harris_county_data <- census_demographic_merge %>%
  filter(County == "Harris County")

# Pivot the data into long format for easier plotting
harris_county_data_long <- harris_county_data %>%
  pivot_longer(cols = c(Hispanic, White, Black, Native, Pacific, Asian),
               names_to = "Ethnicity",
               values_to = "Votes")

# Plotting
ggplot(harris_county_data_long, aes(x = Ethnicity, y = Votes, fill = Ethnicity)) +
  geom_bar(stat = "identity") +
  labs(
    x = "Ethnicity",
    y = "Number of Votes",
    title = "Ethnicity Breakdown in Harris County"
  ) +
  theme_minimal()

```


# Question 3: Identifying Male vs. Female dominant voter populations (by county and state)

Here, I am calculating the number of men and women that voted in each county in the 2020 election.
```{r}
gender <- census_demographic_merge %>% 
  select(State, TotalVotes, County, Men, Women, VotingPop, TotalPop)

gender <- gender %>% 
  group_by(County) %>% 
  mutate(femaleVoterPercentage = Women / TotalPop) %>% 
  mutate(femaleVoters = round(femaleVoterPercentage * TotalVotes)) %>% 
  mutate(maleVoters = TotalVotes - femaleVoters)
```

Now that I have found the number of voters of each gender, I can find what are the counties
and states with the highest populations of male and female voters.

Below are the 3 Counties with the largest Female Voter Populations:
```{r}
gender %>% 
  arrange(desc(femaleVoterPercentage)) %>% 
  select(State,County, femaleVoters, maleVoters) %>% 
  head(3)
```

Below are the 3 States with the largest Female Voter Populations:
```{r}
# finds the states with the largest number of total female voters.
stateFemaleVoters <- gender %>% 
  group_by(State) %>% 
  summarize(totalFemaleVoters = sum(femaleVoters, na.rm = TRUE)) %>% 
  arrange(desc(totalFemaleVoters))
head(stateFemaleVoters,3)


# find the states with the largest the number of female majority voting counties
test <- gender %>% 
  group_by(State) %>% 
  filter(femaleVoterPercentage > 0.5) %>% 
  summarize(TotalFemaleMajCounties = sum(femaleVoters, na.rm = TRUE)) %>% 
  arrange(desc(TotalFemaleMajCounties))
head(test, 3)

# find the states with the largest difference between male and female voters
genderDiff <- gender %>% 
  group_by(State) %>% 
  summarize(genderDiff = sum(femaleVoters) - sum(maleVoters)) %>% 
  arrange(desc(genderDiff)) %>% 
  head(10)
  
  ggplot(genderDiff,aes(State,genderDiff, fill = State)) + geom_col()
```

# The Final Cleaned Dataset
```{r}
write_csv(census_demographic_merge, file = "voter_demographic.csv")
```

